# This is Git's per-user configuration file.
[user]
	name = Ari Sweedler
	email = ari@sweedler.com
	username = arisweedler

[core]
	excludesfile = ~/.config/git/ignore
	editor = nvim

[init]
	templatedir = ~/.config/git/template
	defaultBranch = main

[diff]
	submodule = diff

[merge]
	tool = vim_mergetool
	conflictStyle=diff3

[mergetool "vim_mergetool"]
	cmd = nvim -f -c "MergetoolStart" "$MERGED" "$BASE" "$LOCAL" "$REMOTE"
	trustExitCode = true

[mergetool]
	# After performing a merge, the original file with conflict markers can
	# be saved as a file with a .orig extension. I do not want that
	keepBackup = false

[pull]
	ff = only

[stash]
	showPatch = true

[interactive]
	singleKey = true

################################## aesthetics ##################################
[color "branch"]
	current = red reverse
	local = blue
	remote = green

[color "diff"]
	meta = yellow black bold
	frag = magenta black bold
	old = red bold
	new = green bold
	plain = white

[color "status"]
	added = green black bold
	changed = yellow black bold
	untracked = red reverse bold

[pretty]
	# https://git-scm.com/docs/pretty-formats
	# %C(color) ::= color directive
	# %<(N,TX) ::= make the next placeholder take at least N columns, truncate according to TX
	# %h ::= abbreviated commit hash
	# %ar ::= author date, relative to now
	# %an ::= author name (compared to committer name)
	# %s ::= subject (first line of commit message)
	# %w(width, indent1, indent2) ::= change linewrap
	# + ::= A linefeed is inserted before the expansion if expansion is not null
	# %d ::= ref names.
	newlog = "format:\
%C(cyan)%<(9,trunc)%h \
%C(green)%<(12,trunc)%ar \
%C(dim white)%<(12,trunc)[%an]%C(reset) \
%C(reset)%s \
%C(bold reverse cyan)%w(0,0,8)%+d\
%C(reset)"
	# TODO the ref names aren't being colored. This looks like a bug.

#################################### aliases ###################################
[alias]
	# Meta-aliases
	alias = !"git config --list | grep ^alias | cut -c 7- | sort #"
	showme = !"printf \"The alias '$1' is: \"; git config --list | sed /alias.$1=/!d | sed s/[^=]*=// #"

	# Shortcuts
	a = !"git add .; git s"
	d = diff --staged --diff-algorithm=minimal
	f = fetch --append --prune --jobs=4
	ff = pull --ff-only
	l = ll -10
	ll = log --pretty=newlog --graph
	po = !"git push --set-upstream origin $(git rev-parse --abbrev-ref HEAD)"
	rc = rebase --continue
	s = status --short --branch
	df = dotfiles
	wb = wipebranch
	els = editdiffls

	# New commands
	amend = commit --amend --reuse-message=HEAD
	cconfig = config --edit --global
	ctags = !.git/hooks/ctags
	diffls = diff --name-only
	# If I could run ']c' upon starup that would be great. Can't figure it out tho
	editdiffls = !"f() { files=$(git diff --name-only $1); [ -n \"$files\" ] && $EDITOR -p $files || echo \"no changes since ref='$1'\" ;}; f"
	dotfiles = !"git --git-dir=\"$HOME/dotfiles/\" --work-tree=\"$HOME\""
	ls = ls-tree --full-tree -r --abbrev HEAD
	patch = add --patch

	# These are just hard to rememeber or type
	children = !"f() { git rev-list --all --not $1^@ --children | grep $(git rev-parse $1); }; f" # reachable children of a ref
	history-of = ll --follow --
	initt = !"git init; git commit --allow-empty --message 'first commit'"
	yankbranch = !"git branch --show-current | tr -d '\n' | tee /dev/tty | pbcopy"
	wipebranch = !"f() { git branch -D $1; git push origin --delete $1; }; f"
	contains = !"f() {  git tag --contains $1; git branch --contains $1; }; f"

	# Submodule control
	push-all = !"f() { git submodule foreach git push && git push; }; f"
	sub-all = submodule foreach git
	# If HEAD --> branch, this works nicely
	sub-ff = submodule foreach git pull --ff-only
	# Leaves submodules with HEAD pointing to a commit. Not the best.
	# (If git config submodule.branch is set, then HEAD -> commit pointed
	# to by origin/<branch>)
	sub-u = submodule update --remote

	# Searching
	# 'git log -S' to search through changes
	# 'log --grep' to search through commit messages
	grepp = grep --break --heading --line-number
	grep-code = ll -S
	grep-commit = ll --all --grep

	# The Jira ticket suite (only works off of 'dev')
	j-bug = !"git j-ticket bugfix/$1"
	j-experiment = !"git j-ticket ari/$1"
	j-feature = !"git j-ticket feature/$1"
	j-scar = !"git j-ticket scartissue/$1"
	j-ticket = !"git f && git switch --create $1 origin/dev && git po #"
